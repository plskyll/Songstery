{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/book_detail.css' %}">
{% endblock %}

{% block content %}
<div class="book-detail-container">
    <!-- –•–ª—ñ–±–Ω—ñ –∫—Ä–∏—Ö—Ç–∏ -->
    <div class="breadcrumbs">
        <a href="{% url 'core:home' %}">–ì–æ–ª–æ–≤–Ω–∞</a> / {{ book.title }}
    </div>
    
    <!-- –®–∞–ø–∫–∞ –∫–Ω–∏–≥–∏ -->
    <div class="book-header">
        <div class="book-cover-large">
            {% if book.cover_url %}
                <img src="{{ book.cover_url }}" alt="{{ book.title }}">
            {% else %}
                <div class="no-cover">üìö</div>
            {% endif %}
        </div>
        
        <div class="book-info">
            <h1>{{ book.title }}</h1>
            <h2 class="author">{{ book.author }}</h2>
            <p class="meta">
                <span>{{ book.year }}</span>
                {% if book.genre %}
                    <span>‚Ä¢ {{ book.genre }}</span>
                {% endif %}
                <span>‚Ä¢ üëÅ {{ book.views_count }} –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤</span>
            </p>
            
            {% if book.description %}
                <p class="description">{{ book.description }}</p>
            {% endif %}
            
            <div class="actions">
                {% if user.is_authenticated %}
                    <a href="{% url 'core:save_book' book.id %}" class="btn-primary">
                        {% if is_saved %}
                            üíæ –ó–±–µ—Ä–µ–∂–µ–Ω–æ
                        {% else %}
                            üìö –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–Ω–∏–≥—É
                        {% endif %}
                    </a>
                    <a href="{% url 'core:create_playlist' book.id %}" class="btn-secondary">
                        üéµ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–ª–µ–π–ª–∏—Å—Ç
                    </a>
                {% else %}
                    <a href="/admin/login/?next={{ request.path }}" class="btn-primary">
                        –£–≤—ñ–π—Ç–∏ —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- –†–æ–∑–¥—ñ–ª–∏ -->
    {% if chapters %}
    <section class="chapters-section">
        <h2>üìñ –†–æ–∑–¥—ñ–ª–∏ –∫–Ω–∏–≥–∏</h2>
        <div class="chapters-list">
            {% for chapter in chapters %}
            <a href="{% url 'core:chapter_detail' book.id chapter.number %}" 
               class="chapter-card">
                <div class="chapter-number">{{ chapter.number }}</div>
                <div class="chapter-info">
                    <h3>{{ chapter.title }}</h3>
                    {% if chapter.description %}
                        <p class="chapter-desc">{{ chapter.description|truncatewords:20 }}</p>
                    {% endif %}
                    {% if chapter.mood_tags %}
                        <div class="mood-tags">{{ chapter.mood_tags }}</div>
                    {% endif %}
                </div>
                <div class="chapter-stats">
                    üéµ {{ chapter.music_recommendations.count }} —Ç—Ä–µ–∫—ñ–≤
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% else %}
        <div class="empty-state">
            <p>üìñ –†–æ–∑–¥—ñ–ª–∏ —â–µ –Ω–µ –¥–æ–¥–∞–Ω—ñ. –î–æ–¥–∞–π—Ç–µ —ó—Ö –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ!</p>
        </div>
    {% endif %}
    
    <!-- –¢–æ–ø –º—É–∑–∏–∫–∞ -->
    {% if top_music %}
    <section class="top-music-section">
        <h2>üéµ –¢–æ–ø –º—É–∑–∏—á–Ω–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π</h2>
        <div class="music-list-compact">
            {% for music in top_music %}
            <div class="music-item-compact">
                <div class="music-info">
                    <h4>{{ music.track_title }}</h4>
                    <p>{{ music.artist }} ‚Ä¢ –†–æ–∑–¥—ñ–ª {{ music.chapter.number }}</p>
                </div>
                <div class="music-stats">
                    <span>‚ù§Ô∏è {{ music.likes_count }}</span>
                    <a href="{{ music.link_url }}" target="_blank" class="btn-link">–°–ª—É—Ö–∞—Ç–∏</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ñ –ø–ª–µ–π–ª–∏—Å—Ç–∏ -->
    {% if popular_playlists %}
    <section class="playlists-section">
        <h2>üéº –ü–æ–ø—É–ª—è—Ä–Ω—ñ –ø–ª–µ–π–ª–∏—Å—Ç–∏</h2>
        <div class="playlists-grid">
            {% for playlist in popular_playlists %}
            <a href="{% url 'core:playlist_detail' playlist.pk %}" class="playlist-card">
                <h3>{{ playlist.title }}</h3>
                <p>{{ playlist.description|truncatewords:15 }}</p>
                <div class="playlist-meta">
                    <span>üë§ {{ playlist.creator.username }}</span>
                    <span>‚ù§Ô∏è {{ playlist.likes_count }}</span>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}