{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/profile.css' %}">
{% endblock %}

{% block content %}
<div class="profile-container">
    <h1>üë§ –ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</h1>

    <p class="username">{{ user.username }}</p>
    <div class="edit-profile-section" style="margin-bottom: 2rem; background: rgba(45,53,97,0.4); padding: 1.5rem; border-radius: 15px;">
        <h3 style="color: #e8eaf6; margin-bottom: 1rem;">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ</h3>
        <form method="post">
            {% csrf_token %}
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                {{ form.as_p }}
            </div>
            <button type="submit" class="btn-primary" style="margin-top: 1rem; padding: 0.5rem 1.5rem;">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        </form>
    </div>

    <div class="profile-tabs">
        <button class="tab active" onclick="showTab('saved')">
            üìö –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –∫–Ω–∏–≥–∏ ({{ saved_books.count }})
        </button>
        <button class="tab" onclick="showTab('playlists')">
            üéº –ú–æ—ó –ø–ª–µ–π–ª–∏—Å—Ç–∏ ({{ my_playlists.count }})
        </button>
        <button class="tab" onclick="showTab('music')">
            üéµ –ú–æ—ó —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó ({{ my_recommendations.count }})
        </button>
    </div>

    <!-- –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –∫–Ω–∏–≥–∏ -->
    <div id="saved-tab" class="tab-content active">
        <h2>–ó–±–µ—Ä–µ–∂–µ–Ω—ñ –∫–Ω–∏–≥–∏</h2>
        <div class="books-grid">
            {% for saved in saved_books %}
            <a href="{% url 'core:book_detail' saved.book.id %}" class="book-card">
                {% if saved.book.cover_url %}
                    <img src="{{ saved.book.cover_url }}" alt="{{ saved.book.title }}">
                {% else %}
                    <div class="no-cover">üìö</div>
                {% endif %}
                <h3>{{ saved.book.title }}</h3>
                <p>{{ saved.book.author }}</p>
            </a>
            {% empty %}
            <p class="empty">–£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∫–Ω–∏–≥</p>
            {% endfor %}
        </div>
    </div>

    <!-- –ú–æ—ó –ø–ª–µ–π–ª–∏—Å—Ç–∏ -->
    <div id="playlists-tab" class="tab-content">
        <h2>–ú–æ—ó –ø–ª–µ–π–ª–∏—Å—Ç–∏</h2>
        <div class="playlists-list">
            {% for playlist in my_playlists %}
            <a href="{% url 'core:playlist_detail' playlist.id %}" class="playlist-item">
                <div>
                    <h3>{{ playlist.title }}</h3>
                    <p>{{ playlist.book.title }}</p>
                </div>
                <span>‚ù§Ô∏è {{ playlist.likes_count }}</span>
            </a>
            {% empty %}
            <p class="empty">–í–∏ —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–∏–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞</p>
            {% endfor %}
        </div>
    </div>

    <!-- –ú–æ—ó —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó -->
    <div id="music-tab" class="tab-content">
        <h2>–ú–æ—ó –º—É–∑–∏—á–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h2>
        <div class="music-list">
            {% for music in my_recommendations %}
            <div class="music-item">
                <div>
                    <h3>{{ music.track_title }}</h3>
                    <p>{{ music.artist }}</p>
                    <p class="book-info">
                        {{ music.chapter.book.title }} - –†–æ–∑–¥—ñ–ª {{ music.chapter.number }}
                    </p>
                </div>
                <span>‚ù§Ô∏è {{ music.likes_count }}</span>
            </div>
            {% empty %}
            <p class="empty">–í–∏ —â–µ –Ω–µ –¥–æ–¥–∞–ª–∏ –∂–æ–¥–Ω–æ—ó —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤—Å—ñ —Ç–∞–±–∏
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab').forEach(btn => {
        btn.classList.remove('active');
    });

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —Ç–∞–±
    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');
}
</script>
{% endblock %}