{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/home.css' %}">
{% endblock %}

{% block content %}

{% if not user.is_authenticated and not search_query %}
<section class="hero">
    <div class="hero-content">
        <h1>–ó–Ω–∞–π–¥–∏ –º—É–∑–∏–∫—É –¥–æ —Å–≤–æ—î—ó —É–ª—é–±–ª–µ–Ω–æ—ó –∫–Ω–∏–≥–∏</h1>
        <p>–ü–æ—î–¥–Ω—É–π –ª—ñ—Ç–µ—Ä–∞—Ç—É—Ä—É —Ç–∞ –º—É–∑–∏–∫—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ—Å–æ–±–ª–∏–≤–æ–≥–æ –≤–∞–π–±—É</p>
        <a href="#catalog" class="btn-primary">–ü–æ—á–∞—Ç–∏</a>
    </div>
</section>
{% endif %}

<section class="search-section">
    <div class="search-box">
        <form method="get" action="{% url 'core:home' %}">
            <div class="search-input-group">
                <input type="text" name="search" placeholder="–ù–∞–∑–≤–∞ –∫–Ω–∏–≥–∏ –∞–±–æ –∞–≤—Ç–æ—Ä"
                       value="{{ search_query|default:'' }}">
                <button type="submit" class="btn-primary">–®—É–∫–∞—Ç–∏</button>
            </div>
        </form>
        {% if user.is_authenticated %}
        <div style="text-align: center; margin-top: 1rem;">
            <p style="color: #9fa8b8; margin-bottom: 0.5rem;">–ù–µ –∑–Ω–∞–π—à–æ–≤ –∫–Ω–∏–≥—É?</p>
            <a href="{% url 'core:create_book' %}" class="btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1.5rem;">
                + –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –∫–Ω–∏–≥—É
            </a>
        </div>
        {% endif %}
    </div>
</section>

<section class="container" id="catalog">
    <h2 class="section-title">{{ books_section_title }}</h2>

    {% if db_books %}
    <div class="books-grid">
        {% for book in db_books %}
        <a href="{% url 'core:book_detail' book.id %}" class="book-card">
            <div class="book-cover">
                {% with cover=book.get_cover %}
                    {% if cover %}
                        <img src="{{ cover }}" alt="{{ book.title }}" onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=\'font-size:3rem\'>üìö</span>'">
                    {% else %}
                        <span style="font-size: 3rem;">üìö</span>
                    {% endif %}
                {% endwith %}
            </div>
            <div class="book-title" title="{{ book.title }}">{{ book.title }}</div>
            <div class="book-author">{{ book.author }}</div>
        </a>
        {% endfor %}
    </div>

    {% if page_obj.has_other_pages %}
    <div class="pagination" style="text-align: center; margin-top: 2rem;">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&search={{ search_query }}" class="btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
        {% endif %}

        <span style="color: #b8c5d6; margin: 0 1rem;">
            –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&search={{ search_query }}" class="btn-secondary">–î–∞–ª—ñ ‚Üí</a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state" style="text-align: center; padding: 3rem; background: rgba(45,53,97,0.4); border-radius: 15px;">
        <p style="color: #b8c5d6; font-size: 1.2rem; margin-bottom: 1.5rem;">
            –ù–∞ –∂–∞–ª—å, –∑–∞ –≤–∞—à–∏–º –∑–∞–ø–∏—Ç–æ–º –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.
        </p>
        <a href="{% url 'core:create_book' %}" class="btn-primary">
            –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–Ω–∏–≥—É
        </a>
    </div>
    {% endif %}
</section>

{% if top_music_db %}
<section class="container">
    <h2 class="section-title">üéµ –ü–æ–ø—É–ª—è—Ä–Ω–∞ –º—É–∑–∏–∫–∞</h2>
    <div class="music-list">
        {% for music in top_music_db %}
        <a href="{% url 'core:chapter_detail' music.chapter.book.id music.chapter.number %}"
           class="music-item">
            <div class="music-cover">üéµ</div>
            <div class="music-info">
                <div class="music-title">{{ music.track_title }}</div>
                <div class="music-meta">
                    {{ music.artist }} ‚Ä¢ {{ music.chapter.book.title }}
                </div>
            </div>
            <div class="music-likes">
                <span>‚ù§Ô∏è {{ music.likes_count }}</span>
            </div>
        </a>
        {% endfor %}
    </div>
</section>
{% endif %}

{% endblock %}